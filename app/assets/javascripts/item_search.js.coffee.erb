$ ->
  options =
    source: (request, response) ->
      $.ajax
        url: "<%= SEARCH_ENDPOINT %>/item/_search"
        dataType: "json"
        type: 'get'
        data:
          q: request.term
        success: (data) ->
          response($.map(data.hits.hits, (item) ->
            label: "#{item._source.accession_num} - #{item._source.title_en}"
            thumbnail: item._source.thumbnail
            name: item._source.title_en
            url: item._source.url_en
            accession_no: item._source.accession_num))
    select: (event, ui) ->
      group = $(event.target).parents('.item-group')
      debugger
      group.find('input[id$="_url"]').val(ui.item.url)
      group.find('input[id$="_thumbnail"]').val(ui.item.thumbnail)
      group.find('input[id$="_accession_no"]').val(ui.item.accession_no)
      group.find('input[id$="_name"]').val(ui.item.name)

  $('#items').find('input[id$="_search"]').autocomplete(options)

  $('#items').on('cocoon:after-insert', (e, insertedItem) ->
    $(insertedItem).find('input[id$="_search"]').autocomplete(options))
